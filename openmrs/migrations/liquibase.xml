<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

        <changeSet id="bahmni-atomfeed-offset-marker" author="tw" context="rel3">
                <preConditions onFail="MARK_RAN">
                        <sqlCheck expectedResult="0">
                                SELECT COUNT(*) FROM scheduler_task_config where schedulable_class = 'org.openmrs.module.atomfeed.scheduler.tasks.EventRecordsNumberOffsetMarkerTask'
                        </sqlCheck>
                </preConditions>
                <comment>rel3</comment>
                <sql>
                        INSERT INTO  scheduler_task_config  (name, description, schedulable_class,
                        start_time, start_time_pattern, repeat_interval, start_on_startup, started,
                        created_by, date_created, changed_by, date_changed, last_execution_time, uuid )
                        VALUES ('OpenMRS event offset marker task', NULL, 'org.openmrs.module.atomfeed.scheduler.tasks.EventRecordsNumberOffsetMarkerTask',
                        '2014-01-14 00:00:00','MM/dd/yyyy HH:mm:ss',86400, 1, 1,
                        1, now(), NULL, NULL, NULL, uuid());
                </sql>
        </changeSet>
        <changeSet id="default-201604211822" author="Gautam, Angshuman">
            <preConditions onFail="MARK_RAN">
                <sqlCheck expectedResult="0">
                    select count(concept_id) from concept where uuid="5090AAAAAAAAAAAAAAAAAAAAAAAAAAAA";
                </sqlCheck>
            </preConditions>
            <comment>update Height concept uuid to standard CEIL concept uuid</comment>
            <sql>
                update concept set uuid="5090AAAAAAAAAAAAAAAAAAAAAAAAAAAA" where concept_id in (
                select concept_name.concept_id from concept_name where name="Height" and concept_name_type="FULLY_SPECIFIED"
                );
            </sql>
        </changeSet>
        <changeSet id="default-201604211823" author="Gautam, Angshuman">
            <preConditions onFail="MARK_RAN">
                <sqlCheck expectedResult="0">
                    select count(concept_id) from concept where uuid="5089AAAAAAAAAAAAAAAAAAAAAAAAAAAA";
                </sqlCheck>
            </preConditions>
            <comment>update Weight concept uuid to standard CEIL concept uuid</comment>
            <sql>
                update concept set uuid="5089AAAAAAAAAAAAAAAAAAAAAAAAAAAA" where concept_id in (
                select concept_name.concept_id from concept_name where name="Weight" and concept_name_type="FULLY_SPECIFIED"
                );
            </sql>
        </changeSet>
    <changeSet id="default-201905311115" author="Bindu, Angshuman">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM location where name="OT";
            </sqlCheck>
        </preConditions>
        <comment> Add default location for OT module </comment>
        <sql>
            INSERT INTO location (name, description, retired, uuid, date_created, creator) VALUES ('OT', 'Operation Theater', FALSE, uuid(), NOW(), 1);
        </sql>
    </changeSet>
    <changeSet id="default-201907091507" author="Bindu, Angshuman" >
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from location_tag where name = 'Operation Theater' and description = 'Operation Theater';
            </sqlCheck>
        </preConditions>
        <comment>Add operation theater location tag</comment>
        <sql>
            INSERT INTO location_tag(name, description, creator, date_created, retired, uuid) VALUES ('Operation Theater', 'Operation Theater', 1, now(), 0, uuid());
        </sql>
    </changeSet>
    <changeSet id="default-201905311116" author="Bindu, Angshuman">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) from location_tag_map where location_tag_id IN (SELECT location_tag_id from location_tag where name="Operation Theater");
            </sqlCheck>
        </preConditions>
        <comment> Tag OT location as Operation Theatre </comment>
        <sql>
            SELECT location_tag_id INTO @location_tag_id FROM location_tag WHERE name = "Operation Theater" and description = "Operation Theater";
            SELECT location_id INTO @location_id FROM location WHERE location.name="OT" and description = "Operation Theater";

            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_id, @location_tag_id);
        </sql>
    </changeSet>
    <changeSet id="MALAWI-20200201214" author="Santhosh" runAlways="true">
        <comment>Stored Procedure to add reference term</comment>
        <sql>
            DROP PROCEDURE IF EXISTS add_concept_answer;
        </sql>
        <sqlFile path="utils/add_concept_answer.sql" endDelimiter="#"/>
    </changeSet>
    <changeSet id="MALAWI-20200201215" author="Santhosh" runAlways="true">
        <comment>Stored Procedure to add reference term</comment>
        <sql>
            DROP PROCEDURE IF EXISTS add_concept_description;
        </sql>
        <sqlFile path="utils/add_concept_description.sql" endDelimiter="#"/>
    </changeSet>
    <changeSet id="MALAWI-20200201216" author="Santhosh" runAlways="true">
        <comment>Stored Procedure to add reference term</comment>
        <sql>
            DROP PROCEDURE IF EXISTS add_concept_numeric;
        </sql>
        <sqlFile path="utils/add_concept_numeric.sql" endDelimiter="#"/>
    </changeSet>
    <changeSet id="MALAWI-20200201217" author="Santhosh" runAlways="true">
        <comment>Stored Procedure to add reference term</comment>
        <sql>
            DROP PROCEDURE IF EXISTS add_concept_reference_map;
        </sql>
        <sqlFile path="utils/add_concept_reference_map.sql" endDelimiter="#"/>
    </changeSet>
    <changeSet id="MALAWI-20200201218" author="Santhosh" runAlways="true">
        <comment>Stored Procedure to add reference term</comment>
        <sql>
            DROP PROCEDURE IF EXISTS add_concept_set_members;
        </sql>
        <sqlFile path="utils/add_concept_set_members.sql" endDelimiter="#"/>
    </changeSet>
    <changeSet id="MALAWI-20200201219" author="Santhosh" runAlways="true">
        <comment>Stored Procedure to add reference term</comment>
        <sql>
            DROP PROCEDURE IF EXISTS add_concept;
        </sql>
        <sqlFile path="utils/add_concept.sql" endDelimiter="#"/>
    </changeSet>
    <changeSet id="MALAWI-20200201220" author="Santhosh" runAlways="true">
        <sql>
            DROP PROCEDURE IF EXISTS CREATE_REFERENCE_MAPPING_CEIL;
        </sql>
        <sqlFile path="utils/createProcedureForCEIL.sql" endDelimiter="#"/>
    </changeSet>

    <changeSet id="Malawi-201704071423" author="Suraj" runAlways="true">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_reference_source where name = "ICD-O";
            </sqlCheck>
        </preConditions>
        <comment>Adding ICD-O concept_reference_sources</comment>
        <sql>
            INSERT INTO concept_reference_source(name,description,hl7_code,creator,date_created,uuid) values ("ICD-O","ICD-O",NULL,1,now(),uuid());
        </sql>
    </changeSet>

    <changeSet id="Malawi-201704071422" author="Suraj" runAlways="true">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_reference_source where name = "ICHI";
            </sqlCheck>
        </preConditions>
        <comment>Adding ICHI concept_reference_sources</comment>
        <sql>
            INSERT INTO concept_reference_source(name,description,hl7_code,creator,date_created,uuid) values
            ("ICHI","ICHI",NULL,1,now(),uuid());
        </sql>
    </changeSet>

    <changeSet id="MALAWI_CONFIG_050320201211" author="Sreekalyan" runAlways="true">
        <sql>
            DROP PROCEDURE IF EXISTS CREATE_REFERENCE_MAPPING_ICDO;
        </sql>
        <comment>Adding the Procedure for ICDO</comment>
        <sqlFile path="utils/createProcedureForICDO.sql" endDelimiter="#"/>
    </changeSet>

    <changeSet id="MALAWI_CONFIG_050320201212" author="Sreekalyan" runAlways="true">
        <sql>
            DROP PROCEDURE IF EXISTS CREATE_REFERENCE_MAPPING_ICHI;
        </sql>
        <sqlFile  path="utils/createProcedureForICHI.sql" endDelimiter="#"/>
    </changeSet>

    <changeSet id="Malawi-202002021612" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_name where name in ("Oncogynae","Assessment Phase","MDT Phase","Treatment
                Phase","Follow Up Phase","Non-cancer diagnosis","QECH Cancer referral","Transferred out","Lost to follow
                up","Refused care","End of Follow Up","Beyond Curative (Palliative)","Death") and concept_name_type =
                'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            </sqlCheck>
        </preConditions>
        <comment> Adding program concepts </comment>
        <sql>
            set @concept_id = 0;
            set @concept_short_id = 0;
            set @concept_full_id = 0;
            set @count = 0;
            set @uuid = NULL;

            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Oncogynae","Oncogynae","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Oncogynae-workflow","Oncogynae-workflow","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Oncogynae-outcome","Oncogynae-outcome","N/A","Misc",true);

            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Assessment Phase","Assessment Phase","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"MDT Phase","MDT Phase","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Treatment Phase","Treatment Phase","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Follow Up Phase","Follow Up Phase","N/A","Misc",false);

            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Non-cancer diagnosis","Non-cancer diagnosis","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"QECH Cancer referral","QECH Cancer referral","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Transferred out","Transferred out","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Lost to follow up","Lost to follow up","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Refused care","Refused care","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"End of Follow Up","End of Follow Up","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Beyond Curative (Palliative)","Beyond Curative (Palliative)","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Death","Death","N/A","Misc",false);

        </sql>
    </changeSet>

    <changeSet id="Malawi-2020022110505" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">

                select COUNT(*) from concept_set cs
                join concept_name cn
                on cs.concept_id = cn.concept_id
                where cs.concept_id IN (select concept_id from concept_name where name in("Non-cancer diagnosis","QECH
                Cancer referral","Transferred out","Lost to follow up","Refused care","End of Follow Up","Beyond
                Curative (Palliative)","Death") AND concept_name_type = "FULLY_SPECIFIED")
                and cs.concept_set IN (select concept_id from concept_name where name = 'Oncogynae-outcome') and
                concept_name_type = "FULLY_SPECIFIED";


            </sqlCheck>
        </preConditions>
        <comment>Adding set members for "Oncogynae-outcome" concept</comment>
        <sql>
            select concept_id into @Oncogynae_outcome_concept_id from concept_name where name = "Oncogynae-outcome" and concept_name_type = 'FULLY_SPECIFIED' and locale = "en" and voided = 0;

            set @child1_concept_id = 0;
            set @child2_concept_id = 0;
            set @child3_concept_id = 0;
            set @child4_concept_id = 0;
            set @child5_concept_id = 0;
            set @child6_concept_id = 0;
            set @child7_concept_id = 0;
            set @child8_concept_id = 0;

            select concept_id into @child1_concept_id from concept_name where name ="Non-cancer diagnosis" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child2_concept_id from concept_name where name ="QECH Cancer referral" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child3_concept_id from concept_name where name ="Transferred out" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child4_concept_id from concept_name where name ="Lost to follow up" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child5_concept_id from concept_name where name ="Refused care" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child6_concept_id from concept_name where name ="End of Follow Up" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child7_concept_id from concept_name where name ="Beyond Curative (Palliative)" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child8_concept_id from concept_name where name ="Death" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;


            call add_concept_set_members(@Oncogynae_outcome_concept_id, @child1_concept_id, 1);
            call add_concept_set_members(@Oncogynae_outcome_concept_id, @child2_concept_id, 2);
            call add_concept_set_members(@Oncogynae_outcome_concept_id, @child3_concept_id, 3);
            call add_concept_set_members(@Oncogynae_outcome_concept_id, @child4_concept_id, 4);
            call add_concept_set_members(@Oncogynae_outcome_concept_id, @child5_concept_id, 5);
            call add_concept_set_members(@Oncogynae_outcome_concept_id, @child6_concept_id, 6);
            call add_concept_set_members(@Oncogynae_outcome_concept_id, @child7_concept_id, 7);
            call add_concept_set_members(@Oncogynae_outcome_concept_id, @child8_concept_id, 8);

        </sql>
    </changeSet>

    <changeSet id="Malawi-202002211230" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from program where name='Oncogynae';
            </sqlCheck>
        </preConditions>
        <comment> Adding program Oncogynae </comment>
        <sql>

            select concept_id into @Oncogynae_Concept_id from concept_name where name = 'Oncogynae' and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @Oncogynae_Outcome_Concept_id from concept_name where name = 'Oncogynae-outcome' and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select user_id    into @Creator_Concept_id from users where username='superman';

            INSERT INTO program(concept_id,outcomes_concept_id,creator,date_created,name,description,uuid)
            VALUES (@Oncogynae_Concept_id,@Oncogynae_Outcome_Concept_id,@Creator_Concept_id,now(),'Oncogynae','Oncogynae Program',uuid());

        </sql>
    </changeSet>

    <changeSet id="Malawi-202002211304" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from program_workflow pw join concept_name cn on pw.concept_id = cn.concept_id
                where pw.concept_id = (select concept_id from concept_name where name = 'Oncogynae-workflow' and
                concept_name_type = 'FULLY_SPECIFIED') and concept_name_type = 'FULLY_SPECIFIED';
            </sqlCheck>
        </preConditions>
        <comment>Adding Program workflow</comment>
        <sql>

            select program_id into @Oncogynae_program_id from program where name='Oncogynae';
            select concept_id into @Oncogynae_workflow_concept_id from concept_name where name ="Oncogynae-workflow" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select user_id    into @Creator_Concept_id from users where username='superman';

            INSERT INTO program_workflow (program_id , concept_id , creator , date_created , retired , uuid)
            VALUES (@Oncogynae_program_id,@Oncogynae_workflow_concept_id,@Creator_Concept_id, now(),0, uuid());
        </sql>
    </changeSet>

    <changeSet id="Malawi-202002211500" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from program_workflow_state where concept_id in (select concept_id from concept_name
                where name in ('Assessment Phase','MDT Phase','Treatment Phase','Follow Up Phase')
                and program_workflow_id = (select program_workflow_id from program_workflow pw join concept_name cn on
                pw.concept_id = cn.concept_id
                where pw.concept_id = (select concept_id from concept_name where name = 'Oncogynae-workflow' and
                concept_name_type = 'FULLY_SPECIFIED' ) and concept_name_type = 'FULLY_SPECIFIED')
                and concept_name_type = 'FULLY_SPECIFIED');
            </sqlCheck>
        </preConditions>
        <comment>Adding Program states for Oncogynae-workflow </comment>
        <sql>

            select concept_id into @Oncogynae_workflow_concept_id from concept_name where name = "Oncogynae-workflow" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select program_workflow_id into @program_workflow_id from program_workflow where concept_id = @Oncogynae_workflow_concept_id;

            select concept_id into @MDT_Phase_concept_id from concept_name where name = "MDT Phase" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @Treatment_Phase_concept_id from concept_name where name = "Treatment Phase" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @Follow_Up_Phase_concept_id from concept_name where name = "Follow Up Phase" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @Assessment_Phase_concept_id from concept_name where name = "Assessment Phase" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;


            insert into program_workflow_state (program_workflow_id,concept_id,initial,terminal,creator,date_created,retired ,uuid) values
            (@program_workflow_id,@Assessment_Phase_concept_id,0,0,1,now(),0,uuid()),
            (@program_workflow_id,@MDT_Phase_concept_id,0,0,1,now(),0,uuid()),
            (@program_workflow_id,@Treatment_Phase_concept_id,0,0,1,now(),0,uuid()),
            (@program_workflow_id,@Follow_Up_Phase_concept_id,0,0,1,now(),0,uuid());

        </sql>
    </changeSet>

    <changeSet id="Malawi-2020020241123" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_name where name in ('Palliative Care','Palliative
                Care-workflow','Palliative Care-outcome','Outpatient Care','Inpatient Care','Homebased Care') and
                concept_name_type =
                'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            </sqlCheck>
        </preConditions>
        <comment>Adding Palliative Care Program concepts</comment>
        <sql>
            set @concept_id = 0;
            set @concept_short_id = 0;
            set @concept_full_id = 0;
            set @count = 0;
            set @uuid = NULL;

            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Palliative Care","Palliative Care","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Palliative Care-workflow","Palliative Care-workflow","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Palliative Care-outcome","Palliative Care-outcome","N/A","Misc",true);

            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Outpatient Care","Outpatient Care","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Inpatient Care","Inpatient Care","N/A","Misc",false);
            call add_concept(@concept_id,@concept_short_id,@concept_full_id,"Homebased Care","Homebased Care","N/A","Misc",false);

        </sql>
    </changeSet>

    <changeSet id="Malawi-202002241157" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">

                select COUNT(*) from concept_set cs
                join concept_name cn
                on cs.concept_id = cn.concept_id
                where cs.concept_id IN (select concept_id from concept_name where name in("Transferred out","Lost to
                follow up","Refused care","Death","End of Follow Up") AND concept_name_type = "FULLY_SPECIFIED")
                and cs.concept_set IN (select concept_id from concept_name where name = 'Palliative Care-outcome') and
                concept_name_type = "FULLY_SPECIFIED";


            </sqlCheck>
        </preConditions>
        <comment>Adding set members for "Palliative Care-outcome" concept</comment>
        <sql>
            select concept_id into @Palliative_Care_concept_id from concept_name where name = "Palliative Care-outcome" and concept_name_type = 'FULLY_SPECIFIED' and locale = "en" and voided = 0;

            set @child1_concept_id = 0;
            set @child2_concept_id = 0;
            set @child3_concept_id = 0;
            set @child4_concept_id = 0;
            set @child5_concept_id = 0;

            select concept_id into @child1_concept_id from concept_name where name ="Transferred out" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child2_concept_id from concept_name where name ="Lost to follow up" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child3_concept_id from concept_name where name ="Refused care" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child4_concept_id from concept_name where name ="Death" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @child5_concept_id from concept_name where name ="End of Follow Up" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;

            call add_concept_set_members(@Palliative_Care_concept_id, @child1_concept_id, 1);
            call add_concept_set_members(@Palliative_Care_concept_id, @child2_concept_id, 2);
            call add_concept_set_members(@Palliative_Care_concept_id, @child3_concept_id, 3);
            call add_concept_set_members(@Palliative_Care_concept_id, @child4_concept_id, 4);
            call add_concept_set_members(@Palliative_Care_concept_id, @child5_concept_id, 5);

        </sql>
    </changeSet>

    <changeSet id="Malawi-202002241212" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from program where name='Palliative Care';
            </sqlCheck>
        </preConditions>
        <comment> Adding program Palliative Care </comment>
        <sql>

            select concept_id into @Palliative_Care_Concept_id from concept_name where name = 'Palliative Care' and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @Palliative_Care_Outcome_Concept_id from concept_name where name = 'Palliative Care-outcome' and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select user_id    into @Creator_Concept_id from users where username='superman';

            INSERT INTO program(concept_id,outcomes_concept_id,creator,date_created,name,description,uuid)
            VALUES (@Palliative_Care_Concept_id,@Palliative_Care_Outcome_Concept_id,@Creator_Concept_id,now(),'Palliative Care','Palliative Care-outcome',uuid());

        </sql>
    </changeSet>

    <changeSet id="Malawi-202002241215" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from program_workflow pw join concept_name cn on pw.concept_id = cn.concept_id
                where pw.concept_id = (select concept_id from concept_name where name = 'Palliative Care-workflow' and
                concept_name_type = 'FULLY_SPECIFIED') and concept_name_type = 'FULLY_SPECIFIED';
            </sqlCheck>
        </preConditions>
        <comment>Adding Program workflow</comment>
        <sql>

            select program_id into @Palliative_Care_program_id from program where name='Palliative Care';
            select concept_id into @Palliative_Care_workflow_concept_id from concept_name where name ="Palliative Care-workflow" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select user_id    into @Creator_Concept_id from users where username='superman';

            INSERT INTO program_workflow (program_id , concept_id , creator , date_created , retired , uuid)
            VALUES (@Palliative_Care_program_id,@Palliative_Care_workflow_concept_id,@Creator_Concept_id, now(),0,uuid());
        </sql>
    </changeSet>

    <changeSet id="Malawi-202002241237" author="Sreekalyan">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from program_workflow_state where concept_id in (select concept_id from concept_name
                where name in ('Outpatient Care','Inpatient Care','Homebased Care')
                and program_workflow_id = (select program_workflow_id from program_workflow pw join concept_name cn on
                pw.concept_id = cn.concept_id
                where pw.concept_id = (select concept_id from concept_name where name = 'Palliative Care-workflow' and
                concept_name_type = 'FULLY_SPECIFIED' ) and concept_name_type = 'FULLY_SPECIFIED')
                and concept_name_type = 'FULLY_SPECIFIED');
            </sqlCheck>
        </preConditions>
        <comment>Adding Program states for Palliative Care-workflow </comment>
        <sql>

            select concept_id into @Palliative_Care_workflow_concept_id from concept_name where name = "Palliative Care-workflow" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select program_workflow_id into @Palliative_Care_workflow_id from program_workflow where concept_id = @Palliative_Care_workflow_concept_id;

            select concept_id into @Outpatient_Care_concept_id from concept_name where name = "Outpatient Care" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @Inpatient_Care_concept_id from concept_name where name = "Inpatient Care" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;
            select concept_id into @Homebased_Care_concept_id from concept_name where name = "Homebased Care" and concept_name_type = 'FULLY_SPECIFIED' and locale = 'en' and voided = 0;

            insert into program_workflow_state (program_workflow_id,concept_id,initial,terminal,creator,date_created,retired ,uuid) values
            (@Palliative_Care_workflow_id,@Outpatient_Care_concept_id,0,0,1,now(),0,uuid()),
            (@Palliative_Care_workflow_id,@Inpatient_Care_concept_id,0,0,1,now(),0,uuid()),
            (@Palliative_Care_workflow_id,@Homebased_Care_concept_id,0,0,1,now(),0,uuid());

        </sql>
    </changeSet>

    <changeSet id="MALAWI-2020021500" author="Bindu Sreekalyan">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM global_property WHERE property='emrapi.sqlSearch.activePrograms';
            </sqlCheck>
        </preConditions>
        <comment></comment>
        <sqlFile path="ProgramQueues/activeProgramsQueue.sql"/>
    </changeSet>

    <changeSet id="MALAWI-170320201547" author="Suraj">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(*) FROM provider_attribute_type where name="otCalendarColor";
            </sqlCheck>
        </preConditions>
        <comment>Adding provider attribute type for OT calendar color</comment>
        <sql>
            INSERT INTO provider_attribute_type (name, description, datatype, min_occurs, creator, date_created,
            retired, uuid)
            VALUES ("otCalendarColor","Color for provider on OT calendar",
            "org.openmrs.customdatatype.datatype.FreeTextDatatype", 0, 8, NOW(), 0, UUID());
        </sql>
    </changeSet>


    <!--
    <include file="SurgeonPre-OperativeAssessment/SurgeonPreOperativeAssessment.xml"/>
    <include file="Operative-Report/Operative-Report.xml"/>
    <include file="IAA/IAA.xml"/>
    <include file="Post-OperativeAnaesthesia_Note/Post-OperativeAnaesthesiaNote.xml"/>
    <include file="Complications/Complications.xml"/>
    -->
    <include file="OT/OT_Users.xml"/>

    <changeSet id="Malawi-110320201250" author="Suraj">
        <comment>Adding patient listing queues for patients whose are in to be scheduled queue</comment>
        <sql>
            DELETE FROM global_property WHERE property='emrapi.sqlSearch.otToBeScheduledQueue';
        </sql>
        <sqlFile path="OT/patientListingQueueToBeScheduled.sql"/>
    </changeSet>
    <changeSet id="Malawi-110320201251" author="Suraj">
        <comment>Adding patient listing queues for patients whose are in scheduled queue</comment>
        <sql>
            DELETE FROM global_property WHERE property='emrapi.sqlSearch.otScheduledQueue';
        </sql>
        <sqlFile path="OT/patientListingQueueScheduled.sql"/>
    </changeSet>
    <changeSet id="Malawi-180320191212" author="Pritam">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                select count(*) from global_property gp where property = 'patient.nameValidationRegex';
            </sqlCheck>
        </preConditions>
        <comment>Updating global property to accept apostophie in Names field in registartion page</comment>
        <sql>
            update global_property set property_value  = "^[a-zA-Z'_ ]{0,50}$.*$" where property = 'patient.nameValidationRegex';
        </sql>
    </changeSet>
    <changeSet id="MALAWI-1584447336" author="Siva R">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from surgical_appointment_attribute_type where name in ('Surgeon Name', 'Other Surgeon Name',
                'Anaesthetist technician', 'HIV Status')
            </sqlCheck>
        </preConditions>
        <comment>Adding surgical appointment attribute types 'Surgeon Name', 'Other Surgeon Name', 'Anaesthetist
            technician' and 'HIV Status'
        </comment>
        <sql>
            INSERT INTO surgical_appointment_attribute_type (name, description, format, sort_weight, creator,
            date_created, uuid) VALUES('Surgeon Name', 'Surgeon Name', 'java.lang.String' ,'11', 8, NOW(), UUID()),
            ('Other Surgeon Name', 'Other Surgeon Name', 'java.lang.String' ,'12', 8, NOW(), UUID()),
            ('Anaesthetist Technician', 'Anaesthetist Technician', 'java.lang.String' ,'13', 8, NOW(), UUID()),
            ('HIV Status', 'HIV Status', 'java.lang.String' ,'14', 8, NOW(), UUID());
        </sql>
    </changeSet>

    <changeSet id="Malawi-020420202020" author="Suraj">
        <comment>Removing the double space from the Names in Reg page attributes</comment>
        <sql>
            UPDATE person_attribute_type SET name = "Primary Emergency Contact, Name" WHERE name ="Primary  Emergency Contact, Name";
            UPDATE person_attribute_type SET name = "Primary Emergency Contact, Relationship" WHERE name ="Primary  Emergency Contact, Relationship";
            UPDATE person_attribute_type SET name = "Primary Emergency Contact, Phone 1" WHERE name ="Primary  Emergency Contact, Phone 1";
            UPDATE person_attribute_type SET name = "Secondary Emergency Contact, Name" WHERE name ="Secondary  Emergency Contact, Name";
            UPDATE person_attribute_type SET name = "Secondary Emergency Contact, Relationship" WHERE name ="Secondary  Emergency Contact, Relationship";
            UPDATE person_attribute_type SET name = "Secondary Emergency Contact, Phone 1" WHERE name ="Secondary  Emergency Contact, Phone 1";
        </sql>
    </changeSet>

   <changeSet id="MALAWI_CONFIG-030420201317" author="Suraj" runAlways="true">
        <sqlFile  path="utils/bed_allocation.sql" endDelimiter="#"/>
    </changeSet>

    <changeSet id="Malawi-060420201639" author="Suraj">
        <comment>Updating the concept DISCHARGE to Discharge </comment>
        <sql>
            UPDATE concept SET is_set = 0 WHERE concept_id = (SELECT concept_id FROM concept_name WHERE name = 'DISCHARGE' and concept_name_type = 'FULLY_SPECIFIED');
            UPDATE concept_name SET name = 'Discharge' WHERE name = 'DISCHARGE' and concept_name_type in ('FULLY_SPECIFIED','SHORT');
        </sql>
    </changeSet>

	<changeSet id="MALAWI_CONFIG-070420201526" author="Suraj">
        <comment>Adding IPD Location to MALAWI</comment>
        <sql>
            INSERT INTO location (name, description, retired, uuid, date_created, creator) VALUES ('IPD', 'IPD', FALSE, uuid(), NOW(), 1);

            SELECT location_tag_id INTO @location_tag_id FROM location_tag WHERE name = 'Login Location';

            SELECT location_id INTO @location_id1 FROM location WHERE location.name='IPD';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_id1, @location_tag_id);

        </sql>
    </changeSet>

    <changeSet id="MALAWI_CONFIG-070420201527" author="Suraj">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                select count(*) from location where name in('IPD') and
                parent_location is null;
            </sqlCheck>
        </preConditions>
        <comment>Mapping IPD to Visit location</comment>
        <sql>
            SELECT location_id INTO @location_id1 FROM location WHERE location.name='Malawi';
            UPDATE location set parent_location = @location_id1 where name = 'IPD';
        </sql>
    </changeSet>

	<changeSet id="MALAWI_CONFIG-070420201528" author="Suraj">
        <comment>Adding OT Location to MALAWI</comment>
        <sql>
            INSERT INTO location (name, description, retired, uuid, date_created, creator) VALUES ('OT', 'Operation Theater', FALSE, uuid(), NOW(), 1);

            SELECT location_tag_id INTO @location_tag_id FROM location_tag WHERE name = 'Login Location';

            SELECT location_id INTO @location_id1 FROM location WHERE location.name='OT';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@location_id1, @location_tag_id);
        </sql>
    </changeSet>

    <changeSet id="MALAWI_CONFIG-070420201529" author="Suraj">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                select count(*) from location where name in('OT') and
                parent_location is null;
            </sqlCheck>
        </preConditions>
        <comment>Mapping OT to Visit location</comment>
        <sql>
            SELECT location_id INTO @location_id1 FROM location WHERE location.name='Malawi';
            UPDATE location set parent_location = @location_id1 where name = 'OT';
        </sql>
    </changeSet>

    <!--<changeSet id="MALAWI_CONFIG-070420201530" author="Suraj">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT count(1) from visit_type where name = 'IPD';
            </sqlCheck>
        </preConditions>
        <comment>Add IPD visit type</comment>
        <sql>
            INSERT INTO visit_type(name, description, creator, date_created, retired, uuid) VALUES ('IPD', 'IPD visit', 1, now(), 0, uuid());
        </sql>
    </changeSet>-->

    <changeSet id="MALAWI_CONFIG-080420202140" author="Suraj">
        <comment>Stored Procedure to add reference term</comment>
        <sqlFile path="utils/createReferenceMappingORGOPENMRSMODULEEMRAPI.sql" endDelimiter="#"/>
    </changeSet>

    <include file="BedManagement/BedManagement.xml"/>

    <changeSet id="malawi-202004231453" author="Vinisha, Bindu">
        <comment>Adding global property for surgical appointments display control</comment>
        <sqlFile path="OT/surgicalAppointments.sql"/>
    </changeSet>
    <changeSet id="malawi-202103222255" author="Tarun, Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT count(*) FROM global_property WHERE property = "webservices.rest.maxResultsDefault";
            </sqlCheck>
        </preConditions>
        <comment>Updating the global property for webservices maxResultsDefault</comment>
        <sql>
            UPDATE global_property
            SET property_value = 200
            WHERE property = "webservices.rest.maxResultsDefault";
        </sql>
    </changeSet>
    <changeSet id="malawi-202103222256" author="Bindu">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT count(*) FROM global_property WHERE property = "obs.complex_obs_dir";
            </sqlCheck>
        </preConditions>
        <comment>Update value for obs.complex_obs_dir global property</comment>
        <sql>
            update global_property set property_value = 'complex_obs' where property = 'obs.complex_obs_dir';
        </sql>
    </changeSet>

    <changeSet id="Malawi-202109011023" author="Tarun">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_reference_source where name = "MSFOCP";
            </sqlCheck>
        </preConditions>
        <comment>Adding MSFOCP concept_reference_sources</comment>
        <sql>
            INSERT INTO concept_reference_source(name,description,hl7_code,creator,date_created,uuid) values ("MSFOCP","MSFOCP",NULL,1,now(),uuid());
        </sql>
    </changeSet>

    <changeSet id="Malawi-202109011024" author="Tarun">
        <sql>
            DROP PROCEDURE IF EXISTS CREATE_REFERENCE_MAPPING_MSFOCP;
        </sql>
        <sqlFile path="utils/createProcedureForMSFOCP.sql" endDelimiter="#"/>
    </changeSet>

    <changeSet id="Malawi-202110251822" author="Venky, Supriya">
        <preConditions>
            <sqlCheck expectedResult="1">
                    select count(*) from address_hierarchy_entry where name = 'Nkkhota Kota';
            </sqlCheck>
        </preConditions>
        <comment>update District table Nkkhota Kota to Nkhotakota</comment>
        <sql>
                update address_hierarchy_entry set name = "Nkhotakota" where name = "Nkkhota Kota";
                update person_address set address3 = "Nkhotakota" where address3 = "Nkkhota Kota";
        </sql>
    </changeSet>

    <changeSet id="Malawi-202110251823" author="Venky, Supriya">
        <preConditions>
            <sqlCheck expectedResult="1">
                    select count(*) from address_hierarchy_entry where name = 'Machinja Boma';
            </sqlCheck>
        </preConditions>
        <comment>update TA table Machinja Boma to Machinga Boma</comment>
        <sql>
                update address_hierarchy_entry set name = "Machinga Boma" where name = "Machinja Boma";
                update person_address set address4 = "Machinga Boma" where address4 = "Machinja Boma";
        </sql>
    </changeSet>

    <changeSet id="Malawi-202110251824" author="Venky, Supriya">
        <preConditions>
            <sqlCheck expectedResult="1">
                    select count(*) from address_hierarchy_entry where name = 'Chriadzulu';
            </sqlCheck>
        </preConditions>
        <comment>update TA table Chriadzulu to Chiradzulu</comment>
        <sql>
                update address_hierarchy_entry set name = "Chiradzulu" where name = "Chriadzulu";
                update person_address set address3 = "Chiradzulu" where address3 = "Chriadzulu";
        </sql>
    </changeSet>

    <changeSet id="Malawi-202110251825" author="Venky, Supriya">
        <preConditions>
            <sqlCheck expectedResult="1">
                    select count(*) from address_hierarchy_entry where name = 'Chriradzulu BOMA';
            </sqlCheck>
        </preConditions>
        <comment>update TA table Chriradzulu BOMA to Chiradzulu BOMA</comment>
        <sql>
                update address_hierarchy_entry set name = "Chiradzulu BOMA" where name = "Chriradzulu BOMA";
                update person_address set address4 = "Chiradzulu BOMA" where address4 = "Chriradzulu BOMA";
        </sql>
    </changeSet>

    <changeSet id="Malawi-202110251826" author="Venky, Supriya">
        <preConditions>
            <sqlCheck expectedResult="1">
                    select count(*) from address_hierarchy_entry where name = 'TA Machinjiri';
            </sqlCheck>
        </preConditions>
        <comment>update TA table TA Machinjiri to TA Machinjili</comment>
        <sql>
                update address_hierarchy_entry set name = "TA Machinjili" where name = "TA Machinjiri";
                update person_address set address4 = "TA Machinjili" where address4 = "TA Machinjiri";
        </sql>
    </changeSet>

    <changeSet id="Malawi-202110261826" author="Venky, Supriya">
        <preConditions>
            <sqlCheck expectedResult="1">
                    select count(*) from address_hierarchy_level where name = 'District/City';
            </sqlCheck>
        </preConditions>
        <comment>update District/City to District in address_hierarcht_level</comment>
        <sql>
                update address_hierarchy_level set name = "District" where name = "District/City";
        </sql>
    </changeSet>

    <include file="PatientHistory/PatientHistory.xml"/>
    <include file="Leep/Leep.xml"/>
    <include file="VitalSigns/VitalSigns.xml"/>
    <include file="Colposcopy/Colposcopy.xml"/>
    <include file="Laboratory/Laboratory.xml"/>
    <include file="SymptomsAssessment/SymptomsAssessment.xml"/>
    <include file="UltraSound/UltraSound.xml"/>
    <include file="InitialConsultation/InitialConsultation.xml"/>
    <include file="SubsequentConsultation/SubsequentConsultation.xml"/>
    <changeSet id="Malawi-20211130122009" author="Supriya, Bindu">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="1">
                SELECT count(*) from global_property
                where property = 'atomfeed.publish.eventsForPatientProgramStateChange';
            </sqlCheck>
        </preConditions>
        <comment>Enable publishing events for patient program state change</comment>
        <update tableName="global_property">
            <column name="property_value" value="true" />
            <where>property = 'atomfeed.publish.eventsForPatientProgramStateChange'</where>
        </update>
    </changeSet>
    <changeSet id="MALAWI-202201111246" author="Supriya, Tarun">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="1">
                SELECT count(*) FROM global_property WHERE property='emrapi.sqlSearch.activePrograms';
            </sqlCheck>
        </preConditions>
        <comment>Removed bed management related information in program queues</comment>
        <sqlFile path="ProgramQueues/activeProgramsQueue_v1.sql"/>
    </changeSet>
    <include file="PreTreatmentMDT/PreTreatmentMDT.xml"/>
    <include file="Appointment-Scheduling/addProviders.xml"/>
    <include file="Appointment-Scheduling/addServices.xml"/>
    <include file="PainAssessment/PainAssessment.xml"/>
    <include file="PalliativeCareAssessment/PalliativeCareAssessment.xml"/>
    <include file="PostOperativeMDT/PostOperativeMDT.xml"/>
    <changeSet id="Malawi-202202281135" author="Supriya">
        <preConditions>
            <sqlCheck expectedResult="0">
                select count(*) from location_tag_map where location_tag_id = (select location_tag_id from location_tag where name="Appointment Location")
                AND location_id = (select location_id from location where name="OPD");
            </sqlCheck>
        </preConditions>
        <comment>Add OPD To Appointment location</comment>
        <sql>
            SELECT location_id INTO @locationID FROM location WHERE name = 'OPD' and description = 'OPD Login Location';
            SELECT location_tag_id INTO @location_tagID FROM location_tag WHERE name = 'Appointment Location' AND description = 'When a user user creates a appointment service and chooses a location, they may only choose one with this tag';
            INSERT INTO location_tag_map(location_id, location_tag_id) VALUES(@locationID, @location_tagID);
        </sql>
    </changeSet>
    <changeSet id="MALAWI-20220211123" author="Venky">
        <comment>procedure add_new_concept to allow shortname as null</comment>
        <sql>
            DROP PROCEDURE IF EXISTS add_new_concept;
        </sql>
        <sqlFile splitStatements="false" path="utils/AddNewConcept_v1.sql"/>
    </changeSet>
    <changeSet id="MALAWI-20220211124" author="venky">
        <comment>MOBN-860 | Adding a new procedure to add new drugs</comment>
        <sql>
            DROP PROCEDURE IF EXISTS add_new_drug;
        </sql>
        <sqlFile splitStatements="false" path="drugs/AddNewDrug.sql"/>
    </changeSet>
    <include file="BereavementForm/BereavementForm.xml"/>
</databaseChangeLog>
